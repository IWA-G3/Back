<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="layout :: headerFragment">
</head>
<body>
<h1>Covid Alert</h1>

<button type="button" onclick="getLocation()" class="btn btn-outline-primary">Localisez-vous</button>

<button type="button" class="btn btn-outline-danger" onclick="declarePositive()">Vous avez été testé positif</button>

<button type="button" class="btn btn-outline-secondary">Déconnexion</button>

<br/><br/>
<div class="alert alert-success" id="localisation_success" role="alert"></div>
<div class="alert alert-danger" id="localisation_failure" role="alert"></div>


<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script>
    var x = document.getElementById("localisation_success")
    var y = document.getElementById("localisation_failure")

    if(x.innerHTML === ""){
        console.log("vide")
        x.style.display = "none"
    }

    if(y.innerHTML === ""){
        y.style.display = "none"
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(sendPosition)
        } else {
            y.innerHTML = "La localisation n'a pas fonctionné. Essayez avec un autre navigateur";
            y.style.display = ""
            setTimeout(() => { y.style.display = "none";}, 5000)

        }
    }

    function sendPosition(position) {
        jQuery(document).ready(function () {
            jQuery.post("http://localhost:8080/api/locations/add?longitude=" + position.coords.longitude + "&latitude="
            + position.coords.latitude + "&userid=1", (data) => {
                console.log(data)
                x.innerHTML = "Vous avez été localisé. Pensez à vérifier vos mails pour savoir si vous êtes sur une localisation dangereuse"
                x.style.display = ""
                setTimeout(() => { x.style.display = "none";}, 5000)

            })
        })
    }
</script>

<th:block layout:fragment="layout :: scripts"></th:block>

</body>

</html>